
@{
    ViewBag.Title = "集計表VIEWフォーマット設定​";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link href="/Content/common.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/Content/view_dynamic_table.css" />
    <!-- <link rel="stylesheet" type="text/css" href="/Content/multi_select_dynamic_table.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" /> -->
}

<div class="content container-fluid">
    <div id="dynamic_table_page_header"><span id="nav1">合計 </span>><span id="nav2"> 集計表詳細設定​</span></div> 
    <br/><br/>

    <!-----------------Dynamic Table list: dropdown selection----------------->        
    <div class="row" id="dynamic_table_search">
        <div class="col-3">
            <select id="table_list" class="">                
            </select>
        </div>
        <div class="col-2">
            <button type="submit" class="btn btn-light mb-2" id="search_dynamic_table">表示​ (show)</button>
        </div>        
    </div>

    <!--table setting: items insert form-->
    <div class="total_menu_list_tbl" style="display:none;"> 
        <div class="row">
            <div class="col-md-11">
                <table id="total_menu_setting_items_tbl">
                    <thead id="total_menu_list_thead">                                       
                    </thead>

                    <tbody id="total_menu_list_tbody">                                    
                    </tbody>
                </table>
            </div>
        </div>
        <div class="dynamic_table_list_action">        
            <div class="row" >                           
                <div class="col-md-2"></div>
                <div class="col-md-2">
                    <a href="javascript:void(0);" class="list_table_edit_btn">保存​(save)</a>
                </div>
                <div class="col-md-2">
                    <a href="javascript:void(0);" class="list_table_add_btn">追加​(add)</a>
                </div>
                <div class="col-md-2">
                    <a href="javascript:void(0);" class="list_table_delete_btn">削除​ (delete)</a>                    
                </div>            
            </div>
        </div>
    </div>
    <br />

    <input type="hidden" id="main_item_settings" value=""/>
    <input type="hidden" id="sub_item_settings" value=""/>
    <input type="hidden" id="detail_item_settings" value=""/>    
    <input type="hidden" id="setting_column_count" value=""/>

    <!-----------------Modal: Delete Dynamic Table----------------->
    <div class="modal custom-modal fade" id="delete_settings_table" role="dialog">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="form-header">
                        <h3 class="delete_confirm_header">削除確認​ (Delete Settings)</h3>
                        <ol class="section_count" style="text-align:left;"></ol>
                        <p style="margin-left: -151px;">選択した設定を削除しますか?</p>
                    </div>
                    <div class="modal-btn delete-action">
                        <div class="row">
                            <div class="col-3"></div>
                            <div class="col-3"></div>
                            <div class="col-3">
                                <a href="javascript:void(0);" class="btn confrim_del_btn">はい (Y)​</a></label>
                            </div>

                            <div class="col-3">
                                <a href="javascript:void(0);" data-dismiss="modal" class="btn confrim_cancel_btn">いいえ (N)​</a></label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts{    
    <script src="/Scripts/common.js"></script>
    <script src="/Scripts/view_dynamic_table.js"></script>  
    <!-- <script src="/Scripts/bootstrap-select.min.js"></script>       -->
    <!-- <script src="/Scripts/multi_select_dynamic_table.js"></script>       -->
    <script src="~/signalr/hubs"></script>
    
    <script type="text/javascript">
            $.connection.hub.disconnected(function () {
                setTimeout(function () {
                    $.connection.hub.start();
                }, 5000); // Restart connection after 5 seconds.
            });
            $.connection.hub.start();
            $(function () {

                var chat = $.connection.chatHub;

                chat.client.addNewMessageToPage = function (name, message) {
                    alert(name + message);
                    $.ajax({
                        url: `/api/utilities/GetUserLogs/`,
                        contentType: 'application/json',
                        type: 'GET',
                        async: false,
                        dataType: 'json',
                        success: function (data) {
                            var userName = $('#user_name').text();
                            $('#user_log').empty();
                            $.each(data, (index, value) => {
                                if (userName !== value.UserName) {
                                    $('#user_log').append(`<li style="float:left;background-color:lightgrey; border-radius:50px; overflow:hidden;margin-right:5px;">${value.UserName}</li>`);
                                }
                            });

                        }
                    });
                };
            });

            $(document).ready(function () {

                setInterval(() => {
                    $.ajax({
                        url: `/api/utilities/GetUserLogs/`,
                        contentType: 'application/json',
                        type: 'GET',
                        async: false,
                        dataType: 'json',
                        success: function (data) {
                            var userName = $('#user_name').text();
                            $('#user_log').empty();
                            $.each(data, (index, value) => {
                                if (userName !== value.UserName) {
                                    $('#user_log').append(`<li style="float:left;background-color:lightgrey; border-radius:50px; overflow:hidden;margin-right:5px;">${value.UserName}</li>`);
                                }
                            });

                        }
                    });
                }, 5000);

                $.ajax({
                url: `/api/utilities/GetUserLogs/`,
                contentType: 'application/json',
                type: 'GET',
                async: false,
                dataType: 'json',
                success: function (data) {
                    var userName = $('#user_name').text();
                    $('#user_log').empty();
                    $.each(data,(index, value) => {
                        if (userName !== value.UserName) {
                            $('#user_log').append(`<li style="float:left;background-color:lightgrey; border-radius:50px; overflow:hidden;margin-right:5px;">${value.UserName}</li>`);
                        }
                    });

                }
            });

        });



    </script>
}


